<%= erb :'components/data_panel', locals: { active_tab: :accounts } %>

<!--
<h1>People</h1>
<% @people.each do |person| %>
  Person: <%= person.name %>
  <br>
<% end %>

<h3>Create people</h3>
<form action="/people" method="post">
  <label for="name">Person name:</label>
  <input name="name" type="text">
  <input type="submit">Create Person</input>
</form>
-->

<h1>Accounts</h1>
<% if @accounts.length == 0 %>
  No accounts
<% else %>
  <% @accounts.each do |account| %>
    Account: <%= account.name %>
    <br>
  <% end %>
<% end %>

<h3>Create accounts</h3>
<form action="/accounts" method="post">
  <label for="name">Account name:</label>
  <input name="name" type="text">
  <input type="submit">Create Account</input>
</form>

<h3>Create transactions</h3>
<form action="/transactions" method="post">
  <label for="name">Name</label>
  <input name="name" />
  <label for="account_id">Account</label>
  <select id="idk" name="account_id">
    <% @accounts.each do |a| %>
      <option value="<%= a.id %>"><%= a.name %></option>
    <% end %>
  </select>
  <label for="amount">Amount</label>
  <input name="amount" type="number" step="0.01" />

  <label for="currency">Currency</label>
  <input name="currency" type="text" />

  <label for="day_of_month">Day of month</label>
  <input name="day_of_month" type="number" />

  <input type="submit">Create Transaction</input>
</form>

<form id="accountform">
  <input type="submit">Filter to this account</input>
</form>

<select id="idk" name="account" form="accountform">
  <% @accounts.each do |a| %>
    <option value="<%= a.id %>"><%= a.name %></option>
  <% end %>
</select>

<h1>Transactions</h1>
<% @cash_flow.each do |i| %>
  <span><%= "#{i.name} | #{i.amount} | Occurs on: #{i.day_of_month} | "%></span>
  <% if @tag_index[i.id] %>
    <%= @tag_index[i.id].map(&:name) %>
  <% end %>
  <form action="/transaction_tags" method="post" name="transaction_#{i.id}_tag_form">
    <label for="name">Tag this transaction</label>
    <input name="name" type="text" />
    <input name="transaction_id" value="<%= i.id %>" hidden />
    <input type="submit" />
  </form>
<% end %>

<h1>Tags</h1>
<select id="tagselect" name="transaction_tag[]" form="tagform" multiple>
  <% @tag_index.values.flatten.map(&:name).uniq.each do |a| %>
    <option value="<%= a %>"><%= a %></option>
  <% end %>
</select>

<form id="tagform">
  <label for="intersection">Intersection</label>
  <% if @is_tag_intersection %>
    <input name="intersection" type="checkbox" checked />
  <% else %>
    <input name="intersection" type="checkbox" />
  <% end %>
  <input type="submit">Filter to this tag</input>
  <input type="text" name="title"></input>
  <button type="submit" formaction="/transaction_tag_sets" formmethod="POST"> Save as Tag Set</button>
</form>

<% if @tagged_transactions %>
  <% @tagged_transactions.each do |tagged_transaction| %>
    <h3><%= "#{tagged_transaction[:title]}" %></h3>
    <h3><%= tagged_transaction[:tags] %></h3>
    <h4><%= @is_tag_intersection ? 'intersection of tags' : 'union of tags' %></h4>
    <% tagged_transaction[:transaction_set].transactions.each do |t| %>
      <%= "#{t.name} | Amount: #{t.amount} | account id: #{t.account_id} | day: #{t.day_of_month}" %>
      <br>
    <% end %>
    <p>Sum: <%= tagged_transaction[:transaction_set].sum %></p>
    <% end %>
<% end %>

<h1>Tag Sets</h1>

<form id="tagsetform">
  <select id="tagsettagselect" name="transaction_tag_set[]" form="tagsetform" multiple>
    <% @tag_sets.each do |tag_set| %>
      <option value="<%= tag_set.id %>"><%= tag_set.title %></option>
    <% end %>
  </select>
  <input type="submit">Filter to these tag sets</input>
</form>


